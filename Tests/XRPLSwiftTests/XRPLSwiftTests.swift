import XCTest
@testable import XRPLSwift

final class XRPLSwiftTests: XCTestCase {
    
    var xrpLedger: Ledger = Ledger(endpoint: .xrpl_rpc_Testnet)
    
    static var allTests = [
        ("testWS", testWS),
        ("testFundWallet", testFundWallet),
        ("testRandom", testRandom),
        ("testGenerateWalletFromSeed", testGenerateWalletFromSeed),
        ("testGenerateWalletFromMnemonicNoDerivationPath", testGenerateWalletFromMnemonicNoDerivationPath),
        ("testGenerateWalletFromMnemonicUsingDerivationPath", testGenerateWalletFromMnemonicUsingDerivationPath),
        ("testGenerateWalletFromMnemonicInvalidMnemonic", testGenerateWalletFromMnemonicInvalidMnemonic),
        ("testSecp256k1DerivationPath", testSecp256k1DerivationPath),
        ("testED25519DerivationPath", testED25519DerivationPath),
        ("testGetTxxs", testGetTxxs),
        ("testGetAccountInfo", testGetAccountInfo),
        ("testGetBalance", testGetBalance),
        ("testSerialization", testSerialization),
        ("readMe", ReadMe),
        ("testSendTx", testSendTx),
        ("testRippleEpoch", testRippleEpoch),
        ("testSetIssuerTrustLine", testSetIssuerTrustLine),
        ("testSetReceiverTrustLine", testSetReceiverTrustLine),
//        ("testEscrowCreateFinish", testEscrowCreateFinish),
//        ("testEscrowCreateCancel", testEscrowCreateCancel),
//        ("testGetPendingEscrows", testGetPendingEscrows),
        ("testTransactionHistory", testTransactionHistory),
//        ("testDisableMaster", testDisableMaster),
        ("testGetSignerList", testGetSignerList),
//        ("testMultiSignEnableMaster", testMultiSignEnableMaster),
        ("testSignerListSet", testSignerListSet),
        ("testAccountID", testAccountID),
        ("testXAddress", testXAddress),
        ("testBip44", testBip44),
    ]
    
    public var testBinary = "0061736D01000000013D0A60057F7F7F7F7F017E60017F017E60027F7F017E60037F7F7F017E60037F7F7E017E60027F7F017F60047F7F7F7F017E6000017E60000060017E017E02CD010D03656E76057472616365000003656E760C6574786E5F72657365727665000103656E760C686F6F6B5F6163636F756E74000203656E760A6F74786E5F6669656C64000303656E760974726163655F6E756D000403656E7608726F6C6C6261636B000403656E76025F67000503656E7606616363657074000403656E760A7574696C5F6163636964000603656E760D6574786E5F6665655F62617365000103656E760A6C65646765725F736571000703656E760C6574786E5F64657461696C73000203656E7604656D697400060304030809090405017001010105030100020621057F0141C08D040B7F0041BB0D0B7F004180080B7F0041C08D040B7F004180080B076608066D656D6F72790200115F5F7761736D5F63616C6C5F63746F7273000D0A5F5F646174615F656E6403010D5F5F676C6F62616C5F6261736503020B5F5F686561705F6261736503030C5F5F64736F5F68616E646C650304046362616B000E04686F6F6B000F0AB15E0302000B2702037F017E238080808000210141102102200120026B2103420021042003200037030820040F0B835E9B01137F017E037F017E087F017E277F037E0A7F057E127F027E037F057E037F047E037F047E037F047E037F047E037F047E037F047E037F047E027F047E037F017C017E047C027F047E0A7F027E037F057E037F047E037F047E037F047E037F047E037F047E037F047E037F047E027F047E037F017C017E047C027F057E357F0C7EE5017F017E087F077E027F057E027F057E027F057E027F057E027F057E027F057E027F057E057F017E087F077E027F057E027F057E027F057E027F057E027F057E027F057E027F057E157F017E017F017E0D7F017E017F017E077F057EE5017F017E087F077E027F057E027F057E027F057E027F057E027F057E027F057E027F057E057F017E087F077E027F057E027F057E027F057E027F057E027F057E027F057E027F057E157F017E017F017E0D7F017E017F017E097F238080808000210141E0082102200120026B2103200324808080800041142104419C8880800021054112210641818020210741A0082108200320086A21092009210A41C008210B2003200B6A210C200C210D4102210E418088808000210F410F2110418F888080002111410D211241002113200320003703D808200F20102011201220131080808080001A200E1081808080001A200D20041082808080001A200A2004200710838080800021142014A721152003201536029C08200328029C082116201621172017AC21182005200620181084808080001A200328029C0821192019211A2004211B201A201B48211C4101211D201C201D71211E0240201E450D0041AE88808000211F4120212042012121201F202020211085808080001A0B410021224101212320032022360298082003202336029808200320223602940802400340411421244181809C01212541152126202520261086808080001A200328029408212720272128202421292028202948212A4101212B202A202B71212C202C450D0141A008212D2003202D6A212E202E212F41C0082130200320306A2131203121322003280294082133203220336A213420342D0000213541FF012136203520367121372003280294082138202F20386A213920392D0000213A41FF01213B203A203B71213C2037213D203C213E203D203E47213F41012140203F204071214102402041450D004100214220032042360298080C020B200328029408214341012144204320446A214520032045360294080C000B0B200328029808214602402046450D0041CE888080002147411A2148420221492047204820491087808080001A0B4208214A42E807214B4130214C41818018214D41B007214E2003204E6A214F204F21504120215141918014215241F0072153200320536A2154205421552055205120521083808080002156200320563703E8072050204C204D1083808080002157200320573703A8072003204B3703A0072003204B3703980720032903A807215820582159204A215A2059205A52215B4101215C205B205C71215D02400240205D450D0041E888808000215E41C900215F41B189808000216041C700216141002162205E205F2060206120621080808080001A0C010B41F889808000216341C500216441BD8A808000216541C300216641002167206320642065206620671080808080001A20032D00B007216841FF0121692068206971216A4107216B206A206B75216C02400240206C450D00427E216D206D216E0C010B20032D00B007216F41FF012170206F20707121712071AD21724291A2C480B001217320722073832174423821752074207586217620032D00B107217741FF012178207720787121792079AD217A4230217B207A207B86217C2076207C7C217D20032D00B207217E41FF01217F207E207F71218001208001AD218101422821820120810120820186218301207D2083017C21840120032D00B30721850141FF0121860120850120860171218701208701AD218801422021890120880120890186218A01208401208A017C218B0120032D00B407218C0141FF01218D01208C01208D0171218E01208E01AD218F014218219001208F0120900186219101208B012091017C21920120032D00B50721930141FF0121940120930120940171219501209501AD2196014210219701209601209701862198012092012098017C21990120032D00B607219A0141FF01219B01209A01209B0171219C01209C01AD219D014208219E01209D01209E0186219F01209901209F017C21A00120032D00B70721A10141FF0121A20120A10120A2017121A30120A301AD21A40120A00120A4017C21A50120A501216E0B206E21A60142A08D0621A70141808B80800021A801410D21A901200320A6013703900720032903900721AA0120A80120A90120AA011084808080001A20032903900721AB0120AB0121AC0120A70121AD0120AC0120AD015521AE01410121AF0120AE0120AF017121B001024020B001450D0044000000205C8FB23F21B10120032903900721B20120B201B921B30120B30120B101A221B40120B4019921B50144000000000000E04321B60120B50120B6016321B70120B7014521B8010240024020B8010D0020B401B021B90120B90121BA010C010B428080808080808080807F21BB0120BB0121BA010B20BA0121BC01200320BC013703A0070B418D8B80800021BD0141C90021BE0141D68B80800021BF0141C70021C001410021C10120BD0120BE0120BF0120C00120C1011080808080001A20032D00B00721C20141FF0121C30120C20120C3017121C401410721C50120C40120C5017521C6010240024020C601450D00427E21C70120C70121C8010C010B20032D00B00721C90141FF0121CA0120C90120CA017121CB0120CB01AD21CC014291A2C480B00121CD0120CC0120CD018321CE01423821CF0120CE0120CF018621D00120032D00B10721D10141FF0121D20120D10120D2017121D30120D301AD21D401423021D50120D40120D5018621D60120D00120D6017C21D70120032D00B20721D80141FF0121D90120D80120D9017121DA0120DA01AD21DB01422821DC0120DB0120DC018621DD0120D70120DD017C21DE0120032D00B30721DF0141FF0121E00120DF0120E0017121E10120E101AD21E201422021E30120E20120E3018621E40120DE0120E4017C21E50120032D00B40721E60141FF0121E70120E60120E7017121E80120E801AD21E901421821EA0120E90120EA018621EB0120E50120EB017C21EC0120032D00B50721ED0141FF0121EE0120ED0120EE017121EF0120EF01AD21F001421021F10120F00120F1018621F20120EC0120F2017C21F30120032D00B60721F40141FF0121F50120F40120F5017121F60120F601AD21F701420821F80120F70120F8018621F90120F30120F9017C21FA0120032D00B70721FB0141FF0121FC0120FB0120FC017121FD0120FD01AD21FE0120FA0120FE017C21FF0120FF0121C8010B20C80121800242A08D06218102419D8C808000218202410D2183022003208002370388072003290388072184022082022083022084021084808080001A20032903880721850220850221860220810221870220860220870255218802410121890220880220890271218A020240208A02450D004400000040E17A743F218B02200329038807218C02208C02B9218D02208D02208B02A2218E02208E0299218F0244000000000000E043219002208F022090026321910220910245219202024002402092020D00208E02B02193022093022194020C010B428080808080808080807F2195022095022194020B2094022196022003209602370398070B0B420021970241A28D80800021980241192199024120219A0241ED01219B0241B001219C022003209C026A219D02209D02219E022003219F0241E90021A002411421A102410321A202410121A302412121A40241F30021A502410821A602412021A702411B21A802411A21A902410E21AA02410421AB02410021AC02410221AD0241808080807821AE02411221AF02410021B002411421B10241900121B202200320B2026A21B30220B30221B40241D00421B502200320B5026A21B60220B60221B70241A00321B802200320B8026A21B90220B90221BA0241B00421BB02200320BB026A21BC0220BC0221BD02419E8D80800021BE02410421BF0241FB8C80800021C002412321C10241D00621C202200320C2026A21C30220C30221C40241F78C80800021C50241D48C80800021C60241F00621C702200320C7026A21C80220C80221C90241BF8C80800021CA02411521CB0241AA8C80800021CC0220032903A00721CD0220CC0220CB0220CD021084808080001A20032903980721CE0220CA0220CB0220CE021084808080001A20C90220B10220C60220C10210888080800021CF02200320CF023703E80620032903E80621D00220C50220BF0220D0021084808080001A20C40220B10220C00220C10210888080800021D102200320D1023703C80620032903C80621D20220BE0220BF0220D2021084808080001A209B0210898080800021D302200320D3023703C006200320B7023602CC0420032903A00721D402420121D50220D40220D5027C21D602200320D6023703A007200320D4023703A80420032903C00621D702200320D7023703A004200320AC0236029C04200320AC0236029804108A8080800021D80220D802A721D902200320D9023602940420BD0220B1021082808080001A200320B0023A00930420032802CC0421DA0220DA0220AF023A000020032D00930421DB0241FF0121DC0220DB0220DC027121DD02410821DE0220DD0220DE027521DF0241FF0121E00220DF0220E0027121E10220032802CC0421E20220E20220E1023A000120032D00930421E30241FF0121E40220E30220E4027121E502410021E60220E50220E6027521E70241FF0121E80220E70220E8027121E90220032802CC0421EA0220EA0220E9023A000220032802CC0421EB02410321EC0220EB0220EC026A21ED02200320ED023602CC04200320AE0236028C04200320AD023A008B0420032D008B0421EE0241FF0121EF0220EE0220EF027121F002410F21F10220F00220F1027121F202412021F30220F20220F3026A21F40220032802CC0421F50220F50220F4023A0000200328028C0421F602411821F70220F60220F7027621F80241FF0121F90220F80220F9027121FA0220032802CC0421FB0220FB0220FA023A0001200328028C0421FC02411021FD0220FC0220FD027621FE0241FF0121FF0220FE0220FF027121800320032802CC042181032081032080033A0002200328028C0421820341082183032082032083037621840341FF012185032084032085037121860320032802CC042187032087032086033A0003200328028C04218803410021890320880320890376218A0341FF01218B03208A03208B0371218C0320032802CC04218D03208D03208C033A000420032802CC04218E034105218F03208E03208F036A21900320032090033602CC04200328029804219103200320910336028404200320A2023A00830420032D00830421920341FF0121930320920320930371219403410F2195032094032095037121960341202197032096032097036A21980320032802CC042199032099032098033A0000200328028404219A034118219B03209A03209B0376219C0341FF01219D03209C03209D0371219E0320032802CC04219F03209F03209E033A000120032802840421A003411021A10320A00320A1037621A20341FF0121A30320A20320A3037121A40320032802CC0421A50320A50320A4033A000220032802840421A603410821A70320A60320A7037621A80341FF0121A90320A80320A9037121AA0320032802CC0421AB0320AB0320AA033A000320032802840421AC03410021AD0320AC0320AD037621AE0341FF0121AF0320AE0320AF037121B00320032802CC0421B10320B10320B0033A000420032802CC0421B203410521B30320B20320B3036A21B403200320B4033602CC04200320AC023602FC03200320AB023A00FB0320032D00FB0321B50341FF0121B60320B50320B6037121B703410F21B80320B70320B8037121B903412021BA0320B90320BA036A21BB0320032802CC0421BC0320BC0320BB033A000020032802FC0321BD03411821BE0320BD0320BE037621BF0341FF0121C00320BF0320C0037121C10320032802CC0421C20320C20320C1033A000120032802FC0321C303411021C40320C30320C4037621C50341FF0121C60320C50320C6037121C70320032802CC0421C80320C80320C7033A000220032802FC0321C903410821CA0320C90320CA037621CB0341FF0121CC0320CB0320CC037121CD0320032802CC0421CE0320CE0320CD033A000320032802FC0321CF03410021D00320CF0320D0037621D10341FF0121D20320D10320D2037121D30320032802CC0421D40320D40320D3033A000420032802CC0421D503410521D60320D50320D6036A21D703200320D7033602CC04200328029C0421D803200320D8033602F403200320AA023A00F30320032D00F30321D90341FF0121DA0320D90320DA037121DB03410F21DC0320DB0320DC037121DD03412021DE0320DD0320DE036A21DF0320032802CC0421E00320E00320DF033A000020032802F40321E103411821E20320E10320E2037621E30341FF0121E40320E30320E4037121E50320032802CC0421E60320E60320E5033A000120032802F40321E703411021E80320E70320E8037621E90341FF0121EA0320E90320EA037121EB0320032802CC0421EC0320EC0320EB033A000220032802F40321ED03410821EE0320ED0320EE037621EF0341FF0121F00320EF0320F0037121F10320032802CC0421F20320F20320F1033A000320032802F40321F303410021F40320F30320F4037621F50341FF0121F60320F50320F6037121F70320032802CC0421F80320F80320F7033A000420032802CC0421F903410521FA0320F90320FA036A21FB03200320FB033602CC0420032802940421FC03410121FD0320FC0320FD036A21FE03200320FE033602EC03200320A9023A00EB0320032802CC0421FF0320FF0320A7023A000020032D00EB0321800420032802CC042181042081042080043A000120032802EC0321820441182183042082042083047621840441FF012185042084042085047121860420032802CC042187042087042086043A000220032802EC03218804411021890420880420890476218A0441FF01218B04208A04208B0471218C0420032802CC04218D04208D04208C043A000320032802EC03218E044108218F04208E04208F047621900441FF012191042090042091047121920420032802CC042193042093042092043A000420032802EC0321940441002195042094042095047621960441FF012197042096042097047121980420032802CC042199042099042098043A000520032802CC04219A044106219B04209A04209B046A219C042003209C043602CC04200328029404219D044105219E04209D04209E046A219F042003209F043602E403200320A8023A00E30320032802CC0421A00420A00420A7023A000020032D00E30321A10420032802CC0421A20420A20420A1043A000120032802E40321A304411821A40420A30420A4047621A50441FF0121A60420A50420A6047121A70420032802CC0421A80420A80420A7043A000220032802E40321A904411021AA0420A90420AA047621AB0441FF0121AC0420AB0420AC047121AD0420032802CC0421AE0420AE0420AD043A000320032802E40321AF04410821B00420AF0420B0047621B10441FF0121B20420B10420B2047121B30420032802CC0421B40420B40420B3043A000420032802E40321B504410021B60420B50420B6047621B70441FF0121B80420B70420B8047121B90420032802CC0421BA0420BA0420B9043A000520032802CC0421BB04410621BC0420BB0420BC046A21BD04200320BD043602CC04200320A3023A00E20320032903A80421BE04200320BE043703D80320032D00E20321BF0441FF0121C00420BF0420C0047121C104410F21C20420C10420C2047121C30441E00021C40420C30420C4046A21C50420032802CC0421C60420C60420C5043A000020032903D80321C704423821C80420C70420C8048821C904423F21CA0420C90420CA048321CB0442C00021CC0420CB0420CC047C21CD0420CD04A721CE0420032802CC0421CF0420CF0420CE043A000120032903D80321D004423021D10420D00420D1048821D20442FF0121D30420D20420D3048321D40420D404A721D50420032802CC0421D60420D60420D5043A000220032903D80321D704422821D80420D70420D8048821D90442FF0121DA0420D90420DA048321DB0420DB04A721DC0420032802CC0421DD0420DD0420DC043A000320032903D80321DE04422021DF0420DE0420DF048821E00442FF0121E10420E00420E1048321E20420E204A721E30420032802CC0421E40420E40420E3043A000420032903D80321E504421821E60420E50420E6048821E70442FF0121E80420E70420E8048321E90420E904A721EA0420032802CC0421EB0420EB0420EA043A000520032903D80321EC04421021ED0420EC0420ED048821EE0442FF0121EF0420EE0420EF048321F00420F004A721F10420032802CC0421F20420F20420F1043A000620032903D80321F304420821F40420F30420F4048821F50442FF0121F60420F50420F6048321F70420F704A721F80420032802CC0421F90420F90420F8043A000720032903D80321FA04420021FB0420FA0420FB048821FC0442FF0121FD0420FC0420FD048321FE0420FE04A721FF0420032802CC0421800520800520FF043A000820032802CC0421810541092182052081052082056A21830520032083053602CC04200320A6023A00D70320032903A00421840520032084053703C80320032D00D70321850541FF0121860520850520860571218705410F2188052087052088057121890541E000218A05208905208A056A218B0520032802CC04218C05208C05208B053A000020032903C803218D054238218E05208D05208E0588218F05423F219005208F052090058321910542C0002192052091052092057C219305209305A721940520032802CC042195052095052094053A000120032903C80321960542302197052096052097058821980542FF0121990520980520990583219A05209A05A7219B0520032802CC04219C05209C05209B053A000220032903C803219D054228219E05209D05209E0588219F0542FF0121A005209F0520A0058321A10520A105A721A20520032802CC0421A30520A30520A2053A000320032903C80321A405422021A50520A40520A5058821A60542FF0121A70520A60520A7058321A80520A805A721A90520032802CC0421AA0520AA0520A9053A000420032903C80321AB05421821AC0520AB0520AC058821AD0542FF0121AE0520AD0520AE058321AF0520AF05A721B00520032802CC0421B10520B10520B0053A000520032903C80321B205421021B30520B20520B3058821B40542FF0121B50520B40520B5058321B60520B605A721B70520032802CC0421B80520B80520B7053A000620032903C80321B905420821BA0520B90520BA058821BB0542FF0121BC0520BB0520BC058321BD0520BD05A721BE0520032802CC0421BF0520BF0520BE053A000720032903C80321C005420021C10520C00520C1058821C20542FF0121C30520C20520C3058321C40520C405A721C50520032802CC0421C60520C60520C5053A000820032802CC0421C705410921C80520C70520C8056A21C905200320C9053602CC0420032802CC0421CA0520CA0520A5023A000020032802CC0421CB0520CB0520A4023A000120032802CC0421CC0520CC0520970237030220032802CC0421CD0520CD0520970237030A20032802CC0421CE0520CE0520970237031220032802CC0421CF0520CF0520970237031920032802CC0421D005412321D10520D00520D1056A21D205200320D2053602CC04200320A3023A00C70320032D00C70321D30541FF0121D40520D30520D4057121D50541800121D60520D50520D6056A21D70520032802CC0421D80520D80520D7053A000020032802CC0421D90520D90520A1023A000120032903B00421DA0520032802CC0421DB0520DB0520DA0537030220032903B80421DC0520032802CC0421DD0520DD0520DC0537030A20032802C00421DE0520032802CC0421DF0520DF0520DE0536021220032802CC0421E005411621E10520E00520E1056A21E205200320E2053602CC04200320A2023A00C60320032D00C60321E30541FF0121E40520E30520E4057121E50541800121E60520E50520E6056A21E70520032802CC0421E80520E80520E7053A000020032802CC0421E90520E90520A1023A000120032903F00621EA0520032802CC0421EB0520EB0520EA0537030220032903F80621EC0520032802CC0421ED0520ED0520EC0537030A20032802800721EE0520032802CC0421EF0520EF0520EE0536021220032802CC0421F005411621F10520F00520F1056A21F205200320F2053602CC0420032802CC0421F30520F30520A002108B808080001A20BA02209A0220B702209B02108C808080001A2003209E023602AC0120032903980721F405420121F50520F40520F5057C21F605200320F60537039807200320F4053703880120032903C00621F705200320F70537038001200320AC0236027C200320AC02360278108A8080800021F80520F805A721F905200320F90536027420B40220B1021082808080001A200320B0023A007320032802AC0121FA0520FA0520AF023A000020032D007321FB0541FF0121FC0520FB0520FC057121FD05410821FE0520FD0520FE057521FF0541FF0121800620FF052080067121810620032802AC012182062082062081063A000120032D007321830641FF012184062083062084067121850641002186062085062086067521870641FF012188062087062088067121890620032802AC01218A06208A062089063A000220032802AC01218B064103218C06208B06208C066A218D062003208D063602AC01200320AE0236026C200320AD023A006B20032D006B218E0641FF01218F06208E06208F0671219006410F2191062090062091067121920641202193062092062093066A21940620032802AC012195062095062094063A0000200328026C21960641182197062096062097067621980641FF0121990620980620990671219A0620032802AC01219B06209B06209A063A0001200328026C219C064110219D06209C06209D0676219E0641FF01219F06209E06209F067121A00620032802AC0121A10620A10620A0063A0002200328026C21A206410821A30620A20620A3067621A40641FF0121A50620A40620A5067121A60620032802AC0121A70620A70620A6063A0003200328026C21A806410021A90620A80620A9067621AA0641FF0121AB0620AA0620AB067121AC0620032802AC0121AD0620AD0620AC063A000420032802AC0121AE06410521AF0620AE0620AF066A21B006200320B0063602AC01200328027821B106200320B106360264200320A2023A006320032D006321B20641FF0121B30620B20620B3067121B406410F21B50620B40620B5067121B606412021B70620B60620B7066A21B80620032802AC0121B90620B90620B8063A0000200328026421BA06411821BB0620BA0620BB067621BC0641FF0121BD0620BC0620BD067121BE0620032802AC0121BF0620BF0620BE063A0001200328026421C006411021C10620C00620C1067621C20641FF0121C30620C20620C3067121C40620032802AC0121C50620C50620C4063A0002200328026421C606410821C70620C60620C7067621C80641FF0121C90620C80620C9067121CA0620032802AC0121CB0620CB0620CA063A0003200328026421CC06410021CD0620CC0620CD067621CE0641FF0121CF0620CE0620CF067121D00620032802AC0121D10620D10620D0063A000420032802AC0121D206410521D30620D20620D3066A21D406200320D4063602AC01200320AC0236025C200320AB023A005B20032D005B21D50641FF0121D60620D50620D6067121D706410F21D80620D70620D8067121D906412021DA0620D90620DA066A21DB0620032802AC0121DC0620DC0620DB063A0000200328025C21DD06411821DE0620DD0620DE067621DF0641FF0121E00620DF0620E0067121E10620032802AC0121E20620E20620E1063A0001200328025C21E306411021E40620E30620E4067621E50641FF0121E60620E50620E6067121E70620032802AC0121E80620E80620E7063A0002200328025C21E906410821EA0620E90620EA067621EB0641FF0121EC0620EB0620EC067121ED0620032802AC0121EE0620EE0620ED063A0003200328025C21EF06410021F00620EF0620F0067621F10641FF0121F20620F10620F2067121F30620032802AC0121F40620F40620F3063A000420032802AC0121F506410521F60620F50620F6066A21F706200320F7063602AC01200328027C21F806200320F806360254200320AA023A005320032D005321F90641FF0121FA0620F90620FA067121FB06410F21FC0620FB0620FC067121FD06412021FE0620FD0620FE066A21FF0620032802AC0121800720800720FF063A0000200328025421810741182182072081072082077621830741FF012184072083072084077121850720032802AC012186072086072085073A0001200328025421870741102188072087072088077621890741FF01218A07208907208A0771218B0720032802AC01218C07208C07208B073A00022003280254218D074108218E07208D07208E0776218F0741FF01219007208F072090077121910720032802AC012192072092072091073A0003200328025421930741002194072093072094077621950741FF012196072095072096077121970720032802AC012198072098072097073A000420032802AC012199074105219A07209907209A076A219B072003209B073602AC012003280274219C074101219D07209C07209D076A219E072003209E0736024C200320A9023A004B20032802AC01219F07209F0720A7023A000020032D004B21A00720032802AC0121A10720A10720A0073A0001200328024C21A207411821A30720A20720A3077621A40741FF0121A50720A40720A5077121A60720032802AC0121A70720A70720A6073A0002200328024C21A807411021A90720A80720A9077621AA0741FF0121AB0720AA0720AB077121AC0720032802AC0121AD0720AD0720AC073A0003200328024C21AE07410821AF0720AE0720AF077621B00741FF0121B10720B00720B1077121B20720032802AC0121B30720B30720B2073A0004200328024C21B407410021B50720B40720B5077621B60741FF0121B70720B60720B7077121B80720032802AC0121B90720B90720B8073A000520032802AC0121BA07410621BB0720BA0720BB076A21BC07200320BC073602AC01200328027421BD07410521BE0720BD0720BE076A21BF07200320BF07360244200320A8023A004320032802AC0121C00720C00720A7023A000020032D004321C10720032802AC0121C20720C20720C1073A0001200328024421C307411821C40720C30720C4077621C50741FF0121C60720C50720C6077121C70720032802AC0121C80720C80720C7073A0002200328024421C907411021CA0720C90720CA077621CB0741FF0121CC0720CB0720CC077121CD0720032802AC0121CE0720CE0720CD073A0003200328024421CF07410821D00720CF0720D0077621D10741FF0121D20720D10720D2077121D30720032802AC0121D40720D40720D3073A0004200328024421D507410021D60720D50720D6077621D70741FF0121D80720D70720D8077121D90720032802AC0121DA0720DA0720D9073A000520032802AC0121DB07410621DC0720DB0720DC076A21DD07200320DD073602AC01200320A3023A004220032903880121DE07200320DE0737033820032D004221DF0741FF0121E00720DF0720E0077121E107410F21E20720E10720E2077121E30741E00021E40720E30720E4076A21E50720032802AC0121E60720E60720E5073A0000200329033821E707423821E80720E70720E8078821E907423F21EA0720E90720EA078321EB0742C00021EC0720EB0720EC077C21ED0720ED07A721EE0720032802AC0121EF0720EF0720EE073A0001200329033821F007423021F10720F00720F1078821F20742FF0121F30720F20720F3078321F40720F407A721F50720032802AC0121F60720F60720F5073A0002200329033821F707422821F80720F70720F8078821F90742FF0121FA0720F90720FA078321FB0720FB07A721FC0720032802AC0121FD0720FD0720FC073A0003200329033821FE07422021FF0720FE0720FF078821800842FF0121810820800820810883218208208208A721830820032802AC012184082084082083083A0004200329033821850842182186082085082086088821870842FF0121880820870820880883218908208908A7218A0820032802AC01218B08208B08208A083A00052003290338218C084210218D08208C08208D0888218E0842FF01218F08208E08208F0883219008209008A721910820032802AC012192082092082091083A0006200329033821930842082194082093082094088821950842FF0121960820950820960883219708209708A721980820032802AC012199082099082098083A00072003290338219A084200219B08209A08209B0888219C0842FF01219D08209C08209D0883219E08209E08A7219F0820032802AC0121A00820A008209F083A000820032802AC0121A108410921A20820A10820A2086A21A308200320A3083602AC01200320A6023A003720032903800121A408200320A40837032820032D003721A50841FF0121A60820A50820A6087121A708410F21A80820A70820A8087121A90841E00021AA0820A90820AA086A21AB0820032802AC0121AC0820AC0820AB083A0000200329032821AD08423821AE0820AD0820AE088821AF08423F21B00820AF0820B0088321B10842C00021B20820B10820B2087C21B30820B308A721B40820032802AC0121B50820B50820B4083A0001200329032821B608423021B70820B60820B7088821B80842FF0121B90820B80820B9088321BA0820BA08A721BB0820032802AC0121BC0820BC0820BB083A0002200329032821BD08422821BE0820BD0820BE088821BF0842FF0121C00820BF0820C0088321C10820C108A721C20820032802AC0121C30820C30820C2083A0003200329032821C408422021C50820C40820C5088821C60842FF0121C70820C60820C7088321C80820C808A721C90820032802AC0121CA0820CA0820C9083A0004200329032821CB08421821CC0820CB0820CC088821CD0842FF0121CE0820CD0820CE088321CF0820CF08A721D00820032802AC0121D10820D10820D0083A0005200329032821D208421021D30820D20820D3088821D40842FF0121D50820D40820D5088321D60820D608A721D70820032802AC0121D80820D80820D7083A0006200329032821D908420821DA0820D90820DA088821DB0842FF0121DC0820DB0820DC088321DD0820DD08A721DE0820032802AC0121DF0820DF0820DE083A0007200329032821E008420021E10820E00820E1088821E20842FF0121E30820E20820E3088321E40820E408A721E50820032802AC0121E60820E60820E5083A000820032802AC0121E708410921E80820E70820E8086A21E908200320E9083602AC0120032802AC0121EA0820EA0820A5023A000020032802AC0121EB0820EB0820A4023A000120032802AC0121EC0820EC0820970237030220032802AC0121ED0820ED0820970237030A20032802AC0121EE0820EE0820970237031220032802AC0121EF0820EF0820970237031920032802AC0121F008412321F10820F00820F1086A21F208200320F2083602AC01200320A3023A002720032D002721F30841FF0121F40820F30820F4087121F50841800121F60820F50820F6086A21F70820032802AC0121F80820F80820F7083A000020032802AC0121F90820F90820A1023A000120032903900121FA0820032802AC0121FB0820FB0820FA0837030220032903980121FC0820032802AC0121FD0820FD0820FC0837030A20032802A00121FE0820032802AC0121FF0820FF0820FE0836021220032802AC0121800941162181092080092081096A21820920032082093602AC01200320A2023A002620032D002621830941FF01218409208309208409712185094180012186092085092086096A21870920032802AC012188092088092087093A000020032802AC0121890920890920A1023A000120032903D006218A0920032802AC01218B09208B09208A0937030220032903D806218C0920032802AC01218D09208D09208C0937030A20032802E006218E0920032802AC01218F09208F09208E0936021220032802AC0121900941162191092090092091096A21920920032092093602AC0120032802AC0121930920930920A002108B808080001A209F02209A02209E02209B02108C808080001A2098022099022097021087808080001A41E00821940920032094096A2195092095092480808080002097020F0B0BC30501004180080BBB05225461783A207374617274656422005461783A2073746172746564006163636F756E745F6669656C645F6C656E005461783A2073664163636F756E74206669656C64206D697373696E67212121005461783A204F7574676F696E67207472616E73616374696F6E00225461783A204E6F6E2D787270207472616E73616374696F6E2064657465637465642C2073656E64696E672064656661756C7420313030302064726F707320746F20726654617822005461783A204E6F6E2D787270207472616E73616374696F6E2064657465637465642C2073656E64696E672064656661756C7420313030302064726F707320746F20726654617800225461783A2058525020526567696F6E207472616E73616374696F6E2064657465637465642C20636F6D707574696E67202520746F2073656E6420746F20726654617822005461783A2058525020526567696F6E207472616E73616374696F6E2064657465637465642C20636F6D707574696E67202520746F2073656E6420746F207266546178006F5F7274786E5F64726F707300225461783A2058525020436F756E747920746178207472616E73616374696F6E2064657465637465642C20636F6D707574696E67202520746F2073656E6420746F20726654617822005461783A2058525020436F756E747920746178207472616E73616374696F6E2064657465637465642C20636F6D707574696E67202520746F2073656E6420746F207266546178006F5F6374786E5F64726F707300726567696F6E5F64726F70735F746F5F73656E6400636F756E74795F64726F70735F746F5F73656E640072686668385A745761656E326654647A363537373873753545527433724B4A7863570072657400724C5669646D44356379463163694C4E574C6D5A364264444E6E505664776A68317200636574005461783A20456D6974746564207472616E73616374696F6E0000B301046E616D6501AB011000057472616365010C6574786E5F72657365727665020C686F6F6B5F6163636F756E74030A6F74786E5F6669656C64040974726163655F6E756D0508726F6C6C6261636B06025F670706616363657074080A7574696C5F6163636964090D6574786E5F6665655F626173650A0A6C65646765725F7365710B0C6574786E5F64657461696C730C04656D69740D115F5F7761736D5F63616C6C5F63746F72730E046362616B0F04686F6F6B00750970726F647563657273010C70726F6365737365642D62790105636C616E6755392E302E30202868747470733A2F2F6769746875622E636F6D2F6C6C766D2F6C6C766D2D70726F6A656374203033393964356139363832623363656637316336353333373365333838393063363363346333363529"
    
    func testKeystoreGenerateRandom() {
        do {
            let firstKeystore = try! RippleKeystoreV3(password: "xrp3swift")
            let firstKeyData = try! JSONEncoder().encode(firstKeystore!.keystoreParams)
            let lastKeyData = try JSONDecoder().decode(
                RippleKeystoreParamsV3.self,
                from: firstKeyData
            )
            let lastKeystore = RippleKeystoreV3(lastKeyData)
            let firstAddress = firstKeystore?.getAddress()
            let lastAddress = lastKeystore?.getAddress()
            XCTAssert(firstAddress == lastAddress)
        } catch {
            XCTFail("Could not generate keystore")
        }
    }
    
    func testKeystoreGenerateFromSeed() {
        do {
            
            let wallet = SeedWallet()
            guard let firstSeed = wallet.seed.data(using: .utf8) else { return }
            
            let firstKeystore = try! RippleKeystoreV3(privateKey: firstSeed, password: "xrp3swift")
            let firstKeyData = try! JSONEncoder().encode(firstKeystore!.keystoreParams)
            let firstAddress = firstKeystore?.getAddress()
            
            let lastKeyData = try JSONDecoder().decode(
                RippleKeystoreParamsV3.self,
                from: firstKeyData
            )
            let lastKeystore = RippleKeystoreV3(lastKeyData)
            guard let lastAddress = lastKeystore?.getAddress() else { return }
            
            let lastSeed = try lastKeystore?.UNSAFE_getPrivateKeyData(password: "xrp3swift", account: lastAddress)
            
            XCTAssert(firstAddress == lastAddress)
            XCTAssert(firstSeed == lastSeed)
        } catch {
            XCTFail("Could not generate keystore")
        }
    }
    
    func testKeystorePK() {
        do {
            let firstKeystore = try! RippleKeystoreV3(password: "xrp3swift")
            guard let address = firstKeystore?.addresses?.first else { return }
            let firstPKData = try firstKeystore?.UNSAFE_getPrivateKeyData(password: "xrp3swift", account: address)
            XCTAssert(firstPKData != nil)
        } catch {
            XCTFail("Could not fetch keystore PK")
        }
    }
    
    func testBip44() {
        let mnemonic = "jar deer fox object wrap flush address birth immune plug spell solve reunion head mobile"
        let seed = Bip39Mnemonic.createSeed(mnemonic: mnemonic)
        let privateKey = PrivateKey(seed: seed, coin: .bitcoin)

        // BIP44 key derivation
        // m/44'
        let purpose = privateKey.derived(at: .hardened(44))

        // m/44'/0'
        let coinType = purpose.derived(at: .hardened(144))

        // m/44'/0'/0'
        let account = coinType.derived(at: .hardened(0))

        // m/44'/0'/0'/0
        let change = account.derived(at: .notHardened(0))

        // m/44'/0'/0'/0/0
        let firstPrivateKey = change.derived(at: .notHardened(0))
        print(firstPrivateKey.get())
        var finalMasterPrivateKey = Data(repeating: 0x00, count: 33)
        finalMasterPrivateKey.replaceSubrange(1...firstPrivateKey.raw.count, with: firstPrivateKey.raw)
        print(firstPrivateKey.publicKey.hexadecimal)
        let address = SeedWallet.deriveAddress(publicKey: firstPrivateKey.publicKey.hexadecimal)
        print(address)
        XCTAssert(address == "rQ9f9FZkbeAVkJ9AYRfMYEaSboGwxHWuDd")
        
    }
    
//    func testMultiSignEnableMaster() {
//        let exp = expectation(description: "Loading stories")
//        let wallet = try! SeedWallet(seed: "ssJip5pqECDQuG5tdSehaKicmkN4d")
//        let signer1 = try! SeedWallet(seed: "shiZka2bSHQKw4CCcZNPFvvA2iAjR")
//        let signer2 = try! SeedWallet(seed: "snqFfd21bfALXF1PDj1ymdQcr3Vhu")
//        let signer3 = try! SeedWallet(seed: "sEdVWZmeUDgQdMEFKTK9kYVX71FKB7o")
////        let set = try! AccountSet(wallet: wallet, clear: .asfDisableMaster)
////        set.ledger.url = .xrpl_rpc_Testnet
//        set.autofill()
//            .map({ (tx) in
//                let _tx = try! tx
//                .addMultiSignSignature(wallet: signer3)
//                .addMultiSignSignature(wallet: signer1)
//                .addMultiSignSignature(wallet: signer2)
//                .submit()
//                .map { (dict) in
//                        print(dict)
//                        exp.fulfill()
//                }
//            })
//
//        waitForExpectations(timeout: 10)
//    }
    
//    func testDisableMaster() {
//        let exp = expectation(description: "Loading stories")
//        let wallet = try! SeedWallet(seed: "ssJip5pqECDQuG5tdSehaKicmkN4d")
////        let set = AccountSet(wallet: wallet, set: .asfDisableMaster)
////        set.ledger.url = .xrpl_rpc_Testnet
//        set.send()
//            .map { (dict) in
//            print(dict)
//            exp.fulfill()
//        }
//        waitForExpectations(timeout: 10)
//    }
    
    func testPing() {
        let exp = expectation(description: "Loading stories")
        xrpLedger.url = .xrpl_rpc_Hooknet
//        xrpLedger.url = .xrpl_rpc_Testnet
        xrpLedger.currentLedgerInfo().map { dict in
            print(dict)
            exp.fulfill()
        }
        waitForExpectations(timeout: 10)
    }
    
    func testGetSignerList() {
        let exp = expectation(description: "Loading stories")
        let wallet = try! SeedWallet(seed: "ssJip5pqECDQuG5tdSehaKicmkN4d")
        xrpLedger.getSignerList(address: wallet.address).map { (dict) in
            print(dict)
            exp.fulfill()
        }
        waitForExpectations(timeout: 10)
    }
    
    func testSignerListSet() {
        let exp = expectation(description: "Loading stories")
        
        let wallet = try! SeedWallet(seed: "ssJip5pqECDQuG5tdSehaKicmkN4d")
        let signer1 = try! SeedWallet(seed: "shiZka2bSHQKw4CCcZNPFvvA2iAjR")
        let signer2 = try! SeedWallet(seed: "snqFfd21bfALXF1PDj1ymdQcr3Vhu")
        let signer3 = try! SeedWallet(seed: "sEdVWZmeUDgQdMEFKTK9kYVX71FKB7o")
        let signers = [signer1, signer2, signer3].map { (wallet) -> SignerEntry in
            return SignerEntry(Account: wallet.address, SignerWeight: 1)
        }
        
        let set = SignerListSet(wallet: wallet, signerQuorum: 3, signerEntries: signers)
        set.ledger.url = .xrpl_rpc_Testnet
        set.send().map { (dict) in
            print(dict)
            exp.fulfill()
        }
        
        waitForExpectations(timeout: 10)
    }

    func testWS() {
        // create the expectation
        let exp = expectation(description: "Loading stories")

        // call my asynchronous method
        let wst = WebSocketTester { (info) in
            print(info)
            exp.fulfill()
        }
        Ledger.ws.delegate = wst
        Ledger.ws.connect(host: LHost.xrpl_ws_Testnet.rawValue, path: "")
        let parameters: [String: Any] = [
            "id" : "test",
            "method" : "fee"
        ]
        let data = try! JSONSerialization.data(withJSONObject: parameters, options: [])
        Ledger.ws.send(data: data)

        // wait three seconds for all outstanding expectations to be fulfilled
        waitForExpectations(timeout: 5)
    }
    
//    func testXummWS() {
//        // create the expectation
//        let exp = expectation(description: "Loading stories")
//
//        let payloadUUID = "7d771ec4-da68-475b-9386-ad2c337b4ca3"
//
//        // call my asynchronous method
//        let wst = WebSocketTester { (info) in
//            print(info)
//            exp.fulfill()
//        }
//        Ledger.ws.delegate = wst
//        Ledger.ws.connect(host: LHost.xrpl_ws_Xumm.rawValue, path: "sign/\(payloadUUID)")
//
//        Ledger.ws.disconnect()
//
//
//        // wait three seconds for all outstanding expectations to be fulfilled
//        waitForExpectations(timeout: 5)
//    }
    
    func testRippleEpoch() {
        let dateString = "2017-11-13T00:00:00.000Z"
        let formatter = DateFormatter()
        formatter.dateFormat = "yyyy-MM-dd'T'HH:mm:ss.SSSZ"
        let date = formatter.date(from: dateString)!
        XCTAssert(date.timeIntervalSinceRippleEpoch == UInt64(563846400))
    }
    
    // snRHnsZfvxCFCum7cBVKEh7wqAX8d
    // rJ8R1shqbfJEdTA3ACByXHhG6kF2Aauohv
    
    func testSetHook() {
        // create the expectation
        let exp = expectation(description: "Set Hook")
        
        // call my asynchronous method
        let wallet = try! SeedWallet(seed: "spxphSZfPGqr5j9pqWyzRHgGRnZpK")
        let hook = SetHook(on: wallet, binary: testBinary)
        hook.ledger.url = .xrpl_rpc_Hooknet
        hook.send().map({ (dict) in
            print(dict)
            exp.fulfill()
        })
        
        // wait three seconds for all outstanding expectations to be fulfilled
        waitForExpectations(timeout: 30)
    }
    
    func testSetIssuerTrustLine() {
        // create the expectation
        let exp = expectation(description: "Loading stories")
        
        // call my asynchronous method
        let wallet = try! SeedWallet(seed: "sEdVLSxBzx6Xi9XTqYj6a88epDSETKR") // radtouEofR55c92fy8xszfQPccjoGi68C3
        let amount = try! Amount(drops: 1000000000000000) // 1000000000000 XRP = 1000000000000000 GMT
        let address = try! Address(rAddress: "rBKQNQRFxW59wSSpmaHjAiZF2qvtige8ZB", tag: 43)
        let currency = TrustSet(from: wallet, to: address, symbol: "GMT", initialValue: amount)
        currency.ledger.url = .xrpl_rpc_Testnet
        currency.send().map({ (dict) in
            print(dict)
            exp.fulfill()
        })
        
        // wait three seconds for all outstanding expectations to be fulfilled
        waitForExpectations(timeout: 30)
    }
    
    func testSetReceiverTrustLine() {
        // create the expectation
        let exp = expectation(description: "Loading stories")
        
        // call my asynchronous method
        let wallet = try! SeedWallet(seed: "ssExhwra2PtqmPWYQvDyHTkycsdGn") // rBKQNQRFxW59wSSpmaHjAiZF2qvtige8ZB
        let amount = try! Amount(drops: 100000000) // 100 XRP
        let address = try! Address(rAddress: "radtouEofR55c92fy8xszfQPccjoGi68C3", tag: 43)
        let currency = TrustSet(from: wallet, to: address, symbol: "GMT", initialValue: amount)
        currency.ledger.url = .xrpl_rpc_Testnet
        currency.send().map({ (dict) in
            print(dict)
            exp.fulfill()
        })
        
        // wait three seconds for all outstanding expectations to be fulfilled
        waitForExpectations(timeout: 10)
    }
    
    func testGetIssuerTrustLines() {
        let exp = expectation(description: "Testing \(#function)")
        let address = try! Address(rAddress: "radtouEofR55c92fy8xszfQPccjoGi68C3", tag: 43)
        _ = xrpLedger.getTrustLines(address: address.rAddress, symbol: "GMT", issuer: "radtouEofR55c92fy8xszfQPccjoGi68C3").map { (xrpCurrency) in
            XCTAssert(xrpCurrency.address == "radtouEofR55c92fy8xszfQPccjoGi68C3")
            XCTAssert(xrpCurrency.balance == "0")
//            XCTAssert(xrpCurrency.limit == "0")
            exp.fulfill()
        }
        waitForExpectations(timeout: 5)
    }
    
    func testGetRecieverTrustLines() {
        let exp = expectation(description: "Testing \(#function)")
        let address = try! Address(rAddress: "rBKQNQRFxW59wSSpmaHjAiZF2qvtige8ZB", tag: 43)
        _ = xrpLedger.getTrustLines(address: address.rAddress, symbol: "GMT", issuer: "radtouEofR55c92fy8xszfQPccjoGi68C3").map { (xrpCurrency) in
            XCTAssert(xrpCurrency.address == "radtouEofR55c92fy8xszfQPccjoGi68C3")
            print(xrpCurrency.balance)
            XCTAssert(xrpCurrency.balance == "0")
            XCTAssert(xrpCurrency.limit == "100")
            exp.fulfill()
        }
        waitForExpectations(timeout: 5)
    }
    
    func testSendCurrency() {
        // create the expectation
        let exp = expectation(description: "Loading stories")
        
        // call my asynchronous method
        let wallet = try! SeedWallet(seed: "sEdVLSxBzx6Xi9XTqYj6a88epDSETKR")
        var amount = try! Amount(drops: 1000000) // 1.0 XRP
        amount.currency = "GMT"
        amount.issuer = "radtouEofR55c92fy8xszfQPccjoGi68C3"
        let address = try! Address(rAddress: "rBKQNQRFxW59wSSpmaHjAiZF2qvtige8ZB", tag: 43)
        let payment = Payment(from: wallet, to: address, amount: amount, sourceTag: 67)
        payment.ledger.url = .xrpl_rpc_Testnet
        payment.send().map({ (dict) in
            print(dict)
            exp.fulfill()
        })
        
        // wait three seconds for all outstanding expectations to be fulfilled
        waitForExpectations(timeout: 10)
    }
    
//    func testEscrowCreateFinish() {
//        let exp = expectation(description: "Testing \(#function)")
//
//        let wallet = try! SeedWallet(seed: "sEdVLSxBzx6Xi9XTqYj6a88epDSETKR")
//        let amount = try! Amount(drops: 1100000)
//        let address = try! Address(rAddress: "rUQyLm1pnvFPcYgAFFVu7MvBgEYqWEfrjp")
//        let create = EscrowCreate(from: wallet, to: address, amount: amount, finishAfter: Date().addingTimeInterval(TimeInterval(5)), cancelAfter: nil)
//        _ = create.send().map { (dict) in
//            DispatchQueue.main.asyncAfter(deadline: .now()+10) {
//                let txJSON = dict["tx_json"] as! NSDictionary
//                let sequence = txJSON["Sequence"] as! UInt32
//                print(txJSON)
//                let finish = EscrowFinish(using: wallet, owner: wallet.address, offerSequence: sequence)
//                _ = finish.send().map { (dict) in
//                    print(dict)
//                    exp.fulfill()
//                }
//            }
//        }
//        waitForExpectations(timeout: 30)
//    }
//
//    func testEscrowCreateCancel() {
//        let exp = expectation(description: "Testing \(#function)")
//
//        let wallet = try! SeedWallet(seed: "sEdVLSxBzx6Xi9XTqYj6a88epDSETKR")
//        let amount = try! Amount(drops: 1100000)
//        let address = try! Address(rAddress: "rUQyLm1pnvFPcYgAFFVu7MvBgEYqWEfrjp")
//        let create = EscrowCreate(from: wallet, to: address, amount: amount, finishAfter: Date().addingTimeInterval(TimeInterval(4)), cancelAfter: Date().addingTimeInterval(TimeInterval(5)))
//        _ = create.send().map { (dict) in
//            DispatchQueue.main.asyncAfter(deadline: .now()+10) {
//                let txJSON = dict["tx_json"] as! NSDictionary
//                let sequence = txJSON["Sequence"] as! UInt32
//                print(txJSON)
//                let finish = EscrowCancel(using: wallet, owner: wallet.address, offerSequence: sequence)
//                _ = finish.send().map { (dict) in
//                    print(dict)
//                    exp.fulfill()
//                }
//            }
//        }
//        waitForExpectations(timeout: 30)
//    }
    
//    func testGetPendingEscrows() {
//        let exp = expectation(description: "Testing \(#function)")
//
//        let wallet = try! SeedWallet(seed: "sEdVLSxBzx6Xi9XTqYj6a88epDSETKR")
//        _ = xrpLedger.getPendingEscrows(address: wallet.address).map { (dict) in
//            print(dict)
//            exp.fulfill()
//        }
//        waitForExpectations(timeout: 5)
//    }
    
    func testTransactionHistory() {
        let exp = expectation(description: "Testing \(#function)")
        
        let wallet = try! SeedWallet(seed: "sEdVLSxBzx6Xi9XTqYj6a88epDSETKR")
        _ = xrpLedger.getTxs(account: wallet.address).map { (txs) in
            exp.fulfill()
        }
        
        waitForExpectations(timeout: 10)
    }
    
    func testRandom() {
        let random = try! URandom()
        let bytes = try! random.bytes(count: 16)
        print(Data(bytes).toHexString())
        let wallet = SeedWallet()
        print(wallet)
    }
    
    func testGenerateWalletFromInvalidSeed() {
        do {
            let _ = try SeedWallet(seed: "xrp")
             XCTFail("Should not generate wallet")
        } catch {
            XCTAssertTrue(
                error is SeedError,
                "Unexpected error type: \(type(of: error))"
            )
        }
    }
    
    func testGenerateWalletFromSeed() {
        do {
            let wallet = try SeedWallet(seed: "snYP7oArxKepd3GPDcrjMsJYiJeJB")
            XCTAssertNotNil(wallet)
            XCTAssertEqual(wallet.publicKey, "02fd0e8479ce8182abd35157bb0fa17a469af27dcb12b5dded697c61809116a33b")
            XCTAssertEqual(wallet.privateKey, "0027690792130fc12883e83ae85946b018b3bede6eedcda3452787a94fc0a17438")
            XCTAssertEqual(wallet.address, "rByLcEZ7iwTBAK8FfjtpFuT7fCzt4kF4r2")
        } catch {
            XCTFail("Could not generate wallet")
        }
    }
    
    func testGenerateWalletFromMnemonicNoDerivationPath() {
        let mnemonic = "abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon about"
        let wallet = try! MnemonicWallet(mnemonic: mnemonic)

        XCTAssertEqual(wallet.publicKey, "031D68BC1A142E6766B2BDFB006CCFE135EF2E0E2E94ABB5CF5C9AB6104776FBAE")
        XCTAssertEqual(wallet.privateKey, "0090802A50AA84EFB6CDB225F17C27616EA94048C179142FECF03F4712A07EA7A4")
        XCTAssertEqual(Address.encodeXAddress(rAddress: wallet.address), "XVMFQQBMhdouRqhPMuawgBMN1AVFTofPAdRsXG5RkPtUPNQ")
    }
    
    func testGenerateWalletFromMnemonicUsingDerivationPath() {
        let mnemonic = "recycle rocket rain scout rule loud pudding they panther advance acquire junk news trumpet bitter"
        let wallet = try! MnemonicWallet(mnemonic: mnemonic, account: 76, change: 1, addressIndex: 4)

        XCTAssertEqual(wallet.publicKey, "034ac49ef8112bb1e8fe9e4610aa24eb48bf6d8d5ddef36adc5b460829aedc61c0".uppercased())
        XCTAssertEqual(wallet.privateKey, "00" + "20adf2745186a58b30172626ed761042904610f42326897aca0a98840036b1a2".uppercased())
        XCTAssertEqual(wallet.address, "rf5UyN1ETEzfQKkD5mdcReQEd2gTk46wiz")
    }
    
    func testGenerateWalletFromMnemonicInvalidMnemonic() {
        do {
            let mnemonic = "xrp xrp xrp xrp xrp xrp xrp xrp xrp xrp xrp xrp"
            let _ = try MnemonicWallet(mnemonic: mnemonic)
        } catch {
            XCTAssertTrue(
                error is SeedError,
                "Unexpected error type: \(type(of: error))"
            )
        }
    }
    
    // Test Message Sign
    func testSign() {
        let messageData = "{\"dob\": \"01/01/2020\"}".data(using: .utf8)!
        guard let fromWallet = try? SeedWallet(seed: "snYP7oArxKepd3GPDcrjMsJYiJeJB") else {
            XCTFail("Could not generate xrp wallet")
            return
        }
        let messageSignature = try fromWallet.sign(
            message: messageData.bytes
        )
        XCTAssert(messageSignature.toHexString() == "3044022037a359ba0c27345ff0e547beb259805acaa1353ce0d5b2337096b0818f74a8aa022066db37e8a1edef037913432ef1897ec115b8b98ef480e6258c9c663785b2a4ef"
        )
    }
    
    // Test Message Sign & Verify
    func testSignAndVerifyMessage() {
        let messageData = "{\"dob\": \"01/01/2020\"}".data(using: .utf8)!
        guard let fromWallet = try? SeedWallet(seed: "snYP7oArxKepd3GPDcrjMsJYiJeJB") else {
            XCTFail("Could not generate xrp wallet")
            return
        }
        do {
            let messageSignature = try fromWallet.sign(
                message: messageData.bytes
            )
            let valid = try SeedWallet.verify(
                signature: messageSignature,
                message: messageData.bytes,
                publicKey: fromWallet.publicKey
            )
            XCTAssert(valid == true)
        } catch {
            XCTFail("Could not generate wallet")
        }
    }
    
    func testSecp256k1DerivationPath() {
        let tests = [
            [
                "00fc04a8e1c707ba9568786ef59bfbbd81c177079a056e15ed479d86c1af8b2d70",
                "037519acdf131ccd412cf8d8b7b09a38e8ceeb62cbf40df797eb8c2e3ed3a2e2e0",
                "snqFfd21bfALXF1PDj1ymdQcr3Vhu",
                "r4gTV9iKgrW4VRjUAFZ6zZgVMDHLW5MCGX"
            ],
            [
                "00cdb06b49b44cb5958a89f6af1303ebeff22344567c37329c28d21834ea72d505",
                "03ee379cfa4fbfc4934750d0f1274c97e38a9269bf8ceac72ea24bbab12cd4ec2f",
                "shmHbzopVRdMe5YAnMb7afMsGA1ps",
                "rKfi51fkW5RCPrjfiXNsPT7Fj6ouKeFgS2"
            ],
            [
                "00d50aed2ec121f41c55c31887e0b74622a8a5babd8cb5cfdffa9f759bb2fe4d72",
                "02a09d126a090fa30ec9171466006d113a391c25b044b5502c89f13610208d3be3",
                "ss5xFsAN7g581aomQX7spuikXvEZV",
                "rQsujmjCUqX2UkgSnjErN7LLK7YovqMq1M"
            ],
            [
                "00bb5ee44acb866914453e9ba9ecc2aa53e2ed703053d2ace22bf689e0c326a005",
                "0309b16830b146e6d6f90b68fdb1363ac436c298ac0ba675478c40a6806e35f5d3",
                "shWtjvRfo5ZrENf3g6ScUWVSZiwe5",
                "rLMk48nzBxUmHkZkDMctZBnwuUzuKyAGz9"
            ],
            [
                "001944b8944a3dcf3019d26302328a5e39db16dd03755569b0d8a8c029e2fdb986",
                "021be5e68fc20cf53f54b77acff66d63f57fc5b85986b3d278ba55758ff18b7655",
                "ss6wZGXGVKJQmCa8XyW7oPPoZAuGC",
                "rK8xxM7q5mM8y43mAJuFno7swh2w7X3Art"
            ],
            [
                "00bdbf4e3adec96b7dafd8bda1af1f39a3e0fb6d80562fb5f3f493d0890526b930",
                "02360fccec17d64b028f5ad8c7574d84fa9962ac0860f8f39784924670931b9598",
                "sn8fLfZc1u3KQyHZiM4XvAV7gb5zG",
                "rKtJbhdsWNy9NjMrViuiKqcwm8n9V7btH3"
            ],
            [
                "00e81033c42d6821827ff63ff2afada9291b4d7d5e19112fe5f728759ab7290caa",
                "02593f9492e8ea193eb727fb9a830670506c550b94888b62c89f9bdc5727ede703",
                "snhx4wD1WmY3ArCi5GJrmCWu3uLaR",
                "rppUJh4YMyEdsTdUYdJct82BzsyrnpRkU2"
            ],
            [
                "0087b9d1b486810d2b4ce24679a270adc5df04817e62a885af447c8f21788db729",
                "0313ce0e1f0cb78beb89a597189c66a363ef95f5bb176465e831ff5c85eafc2200",
                "snSnWjQqnhJXjyy6BYWURMyPAwRmi",
                "rhbmDriGdQexcmiDqHXH36uE3v5Kb4UeBa"
            ],
            [
                "00e4ba6e0a26434f997507a820e2931d01c8d7be5dd520da000c575eac564ed8f3",
                "034dcfc9681dd6b9e3cd837e50810bd76fb24af6b5d1a2eb4ea1994873307e7b03",
                "sncpfnA8Hys5KtTQhEXpvej34wjHj",
                "rnq1Rg1fwgUPisaMvpjbz3fd7wCnDM4hey"
            ],
            [
                "0092fb913245792c9d0032d18afdb20bd36763b5d777e26aa1515b3ce39cee488f",
                "03092fe4837f508c41b98197ab04499a356ee5d193a0fb825e2fb7a8f0e85379ab",
                "ssBcBm3H44AJgMhguu5g6HWYhiHTZ",
                "rCYAs5jCspt3wb5akULR7Zx6Y912G1obt"
            ],
            [
                "0053d3ce49ec0f4cee787519ebcee6cec50157012c9940082d938d7305e3ea1eb5",
                "02bca00063eaa8304f3069c3887dc8e154a9ad7f3ad5c7dcd39ca38ba28f58dea9",
                "spmDyK6dJ1oQo1xbhSvhuBtBfPjBt",
                "rwTtwjBtc3k3zhezi9wprsz6mfgxhoRYn9"
            ],
            [
                "00f6bc9f5a0e086907a6731389dc2b0fa96da84a660e3cd867a5967f7736de124b",
                "02c42a807e2899d0a3f450b87033a54c11661ebe30bfe359292130e18739f5bd2c",
                "ssV8vurkfiv3myD8jZ6xPBoodsgX7",
                "rJqwaFVZoXcWL4wVV9kGxZqGfYTaqeKoYf"
            ],
            [
                "00dc7fd67193f515bee7290c02f2ba94e4c2345525579ce9c654ff0f4f32ec9249",
                "03648942674421a297111a2e836ce6ccd800a9d7767c9c5f5221dad9710520ebd1",
                "sp8uRe9nMriho3SWpSZeUV3r43SeQ",
                "r4uycvyuGhPz9kMz5weDHgoBYQK8sAGvXW"
            ],
            [
                "0087ab103afefe43981b3ea60df795e61f45c494c7f36078a2a4056334f40f9825",
                "023baf690192b164c6dbfb248a9357e6bdf39ca85f9f709c1c00c6044312d2db79",
                "ssq4XdDSEr5kXTxS6ou849iwYG8Eh",
                "rntu6JRKC12Nyt9sE8iATgHzKESyZoVYqe"
            ],
            [
                "00b86ac7969d349944143774008a3b2171e133d01beed43f33569157c17a556c34",
                "02e948359aacb5b2675d957b151290f561badedd065c9ce8e32a23c0779b39ebf5",
                "snCjTj1boumKg9d3rZK8qaWNjnBzy",
                "rQDRHPJfPDCkE65jKBtgtaSY3CpdDjkNZC"
            ],
            [
                "00aff3f16f5c72b0a9650f994cd1aede093c2414da82f9d29a1cb16528e3ddb4a4",
                "02b71c0215b676d69209b7980d90d9a8f48db887784a65e4ffd38be753a98b6cb0",
                "snhDK6Neh8yeXX96McRU3rGGRQrbo",
                "rH77iYSHdrm6SaD15Q6xHJMhsfFZURyhzj"
            ],
            [
                "0072cfd530266a468c997ef2d9a40a898c02859449db93ec78c4ae1fb28705438c",
                "02229054dd28e20f6e25f6771797a3cd0de3d5fd55dfc4de1a4709c48683cdc90d",
                "sasv5H2DRjEkWJDAsBYdBk48nLa1e",
                "rfRLtECrXXZbWPTY1zgyLnEnzSbTBgUYYy"
            ],
            [
                "0086dfb98b438427d7be932cfcd205a457b62270ead48f0662b7c1dcc15a330bb8",
                "037aa922fb49b97c8cca04d57a64be599ddceedcdd4b99ceaafa2c78a1eca56fce",
                "ssiZsmPx5fhpNimWzXGy111tyXTTQ",
                "ravfrPYRRPbHGPVAJqdw8h57bqS4jawhmt"
            ],
            [
                "002ed54b43f27e922014c1f12af59ca7f1c44910ce4e3c603e05aa221f86a95953",
                "032db55994e46fd24b64f9688272faedd09b8af660eec47f7c0fc4a07b646edc5d",
                "sn3qcErHhys9Z7EzgkRRkYTpsroYb",
                "rLtCkxyQJMGoNMHmWdY7gg1Zh3tVAYePSK"
            ],
            [
                "000d5f0f8386268563477093dddbe240cf29b2bd149cde7a8be65387d629a114ed",
                "03b06acd6bf9f733ed12949863c6dfdafebb9c5771658d23046656aeb590b4fee8",
                "shwtWWu2q1UUuF8waXe3LNPaUJ3Wc",
                "rKXXbQeknkC5ZdxA45dXuCVgUpJpHT86US"
            ],
            [
                "00bcd722763f316bc4554aaccaa61e8e060304020adbb578901c9a47bd03e64956",
                "029cb31945f42e0db0a887ab3747a14b789c4108d38232311bd6e8a9c1b4529c03",
                "sniQ7AheddnEu46c48tryizzgDzyi",
                "rUiYmVzXgVurPea56pgdBPCJrzGFxECzcr"
            ]
        ]
        
        for test in tests {
            let privateKey = test[0]
            let publicKey = test[1]
            let seed = test[2]
            let address = test[3]
            let wallet = try! SeedWallet(seed: seed)
            XCTAssertEqual(wallet.privateKey, privateKey)
            XCTAssertEqual(wallet.publicKey, publicKey)
            XCTAssertEqual(wallet.address, address)
            XCTAssertEqual(wallet.seed, seed)
            XCTAssertEqual(SeedWallet.getSeedTypeFrom(publicKey: wallet.publicKey), .secp256k1)
        }
        
    }
    
    func testED25519DerivationPath() {
        let dict = [
            "sEdVWZmeUDgQdMEFKTK9kYVX71FKB7o" : "r34XnDB2zS11NZ1wKJzpU1mjWExGVugTaQ",
            "sEd7zJoVnqg1FxB9EuaHC1AB5UPfHWz" : "rDw51qRrBEeMw7Na1Nh79LN7HYZDo7nZFE",
            "sEdSxVntbihdLyabbfttMCqsaaucVR9" : "rwiyBDfAYegXZyaQcN2L1vAbKRYn2wNFMq",
            "sEdSVwJjEXTYCztqDK4JD9WByH3otDX" : "rQJ4hZzNGkLQhLtKPCmu1ywEw1ai2vgUJN",
            "sEdV3jXjKuUoQTSr1Rb4yw8Kyn9r46U" : "rERRw2Pxbau4tevE61V5vZUwD7Rus5Y6vW",
            "sEdVeUZjuYT47Uy51FQCnzivsuWyiwB" : "rszewT5gRjUgWNEmnfMjvVYzJCkhvWY32i",
            "sEd7MHTewdw4tFYeS7rk7XT4qHiA9jH" : "rBB2rvnf4ztwjgNhinFXQJ91nAZjkFgR3p",
            "sEd7A5jFBSdWbNeKGriQvLr1thBScJh" : "rLAXz8Nz7aDivz7PwThsLFqaKrizepNCdA",
            "sEdVPU9M2uyzVNT4Yb5Dn4tUtYjbFAw" : "rHbHRFPCxD5fnn98TBzsQHJ7SsRq7eHkRj",
            "sEdVfF2zhAmS8gfMYzJ4yWBMeR4BZKc" : "r9PsneKHcAE7kUfiTixomM5Mnwi28tCc7h",
            "sEdTjRtcsQkwthDXUSLi9DHNyJcR8GW" : "rM4soF4XS3wZrmLurvE6ZmudG16Lk5Dur5",
            "sEdVNKeu1Lhpfh7Nf6tRDbxnmMyZ4Dv" : "r4ZwJxq6FDtWjapDtCGhjG6mtNm1nWdJcD",
            "sEd7bK4gf5BHJ1WbaEWx8pKMA9MLHpC" : "rD6tnn51m4o1uXeEK9CFrZ3HR7DcFhiYnp",
            "sEd7jCh3ppnQMsLdGcZ6TZayZaHhBLg" : "rTcBkiRQ1EfFQ4FCCwqXNHpn1yUTAACkj",
            "sEdTFJezurQwSJAbkLygj2gQXBut2wh" : "rnXaMacNbRwcJddbbPbqdcpSUQcfzFmrR8",
            "sEdSWajfQAAWFuDvVZF3AiGucReByLt" : "rBJtow6V3GTdsWMamrxetRDwWs6wwTxcKa",
        ]
        
        for (secret, address) in dict {
            let wallet = try! SeedWallet(seed: secret)
            XCTAssertEqual(wallet.address, address)
            XCTAssertEqual(wallet.seed, secret)
            XCTAssertEqual(SeedWallet.getSeedTypeFrom(publicKey: wallet.publicKey), .ed25519)
        }
    }
    
    func testGetTxxs() {
        // create the expectation
        let exp = expectation(description: "Loading stories")
        
        // call my asynchronous method
        let wallet = try! SeedWallet(seed: "ssExhwra2PtqmPWYQvDyHTkycsdGn") // rBKQNQRFxW59wSSpmaHjAiZF2qvtige8ZB
        _ = xrpLedger.getTxs(account: wallet.address).map { (transactions) in
            print(transactions)
            exp.fulfill()
        }
        
        // wait three seconds for all outstanding expectations to be fulfilled
        waitForExpectations(timeout: 3)
    }
    
    func testGetAccountInfo() {
        // create the expectation
        let exp = expectation(description: "Loading stories")
        
        // call my asynchronous method
        let wallet = try! SeedWallet(seed: "sEdVLSxBzx6Xi9XTqYj6a88epDSETKR")
        _ = xrpLedger.getAccountInfo(account: wallet.address).map { (info) in
            print(info)
            exp.fulfill()
        }
        
        // wait three seconds for all outstanding expectations to be fulfilled
        waitForExpectations(timeout: 3)
    }
    
    func testSendTx() {
        // create the expectation
        let exp = expectation(description: "Loading stories")
        
        // call my asynchronous method
        let wallet = try! SeedWallet(seed: "sEdVLSxBzx6Xi9XTqYj6a88epDSETKR")
        let amount = try! Amount(drops: 1000000)
        let address = try! Address(rAddress: "rUQyLm1pnvFPcYgAFFVu7MvBgEYqWEfrjp", tag: 43)
        let payment = Payment(from: wallet, to: address, amount: amount, sourceTag: 67)
        payment.ledger.url = .xrpl_rpc_Testnet
        payment.send().map({ (dict) in
            print(dict)
            exp.fulfill()
        })
        
        // wait three seconds for all outstanding expectations to be fulfilled
        waitForExpectations(timeout: 10)
    }
    
    func testAccountID() {
        let wallet = SeedWallet()
        let a = Data(wallet.accountID).hexadecimal.uppercased()
        let b = Data(SeedWallet.accountID(for: wallet.address)).hexadecimal.uppercased()
        XCTAssert(a == b)
    }
    
    func testXAddress() {
        let mainNetTests = [
        [
        nil,
        "XVLhHMPHU98es4dbozjVtdWzVrDjtV5fdx1mHp98tDMoQXb",
        "A066C988C712815CC37AF71472B7CBBBD4E2A0A000000000000000000",
        ],[
        0,
        "XVLhHMPHU98es4dbozjVtdWzVrDjtV8AqEL4xcZj5whKbmc",
        "A066C988C712815CC37AF71472B7CBBBD4E2A0A010000000000000000",
        ],[
        1,
        "XVLhHMPHU98es4dbozjVtdWzVrDjtV8xvjGQTYPiAx6gwDC",
        "A066C988C712815CC37AF71472B7CBBBD4E2A0A010100000000000000",
        ],[
        2,
        "XVLhHMPHU98es4dbozjVtdWzVrDjtV8zpDURx7DzBCkrQE7",
        "A066C988C712815CC37AF71472B7CBBBD4E2A0A010200000000000000",
        ],[
        32,
        "XVLhHMPHU98es4dbozjVtdWzVrDjtVoYiC9UvKfjKar4LJe",
        "A066C988C712815CC37AF71472B7CBBBD4E2A0A012000000000000000",
        ],[
        276,
        "XVLhHMPHU98es4dbozjVtdWzVrDjtVoKj3MnFGMXEFMnvJV",
        "A066C988C712815CC37AF71472B7CBBBD4E2A0A011401000000000000",
        ],[
        65591,
        "XVLhHMPHU98es4dbozjVtdWzVrDjtVozpjdhPQVdt3ghaWw",
        "A066C988C712815CC37AF71472B7CBBBD4E2A0A013700010000000000",
        ],[
        16781933,
        "XVLhHMPHU98es4dbozjVtdWzVrDjtVqrDUk2vDpkTjPsY73",
        "A066C988C712815CC37AF71472B7CBBBD4E2A0A016D12000100000000",
        ],[
        4294967294,
        "XVLhHMPHU98es4dbozjVtdWzVrDjtV1kAsixQTdMjbWi39u",
        "A066C988C712815CC37AF71472B7CBBBD4E2A0A01FEFFFFFF00000000",
        ],[
        4294967295,
        "XVLhHMPHU98es4dbozjVtdWzVrDjtV18pX8yuPT7y4xaEHi",
        "A066C988C712815CC37AF71472B7CBBBD4E2A0A01FFFFFFFF00000000",
        ]
        ]
        let rootAccount = "rGWrZyQqhTp9Xu7G5Pkayo7bXjH4k4QYpf"
        for test in mainNetTests {
            let _tag = test[0] as? Int
            let tag = _tag == nil ? nil : UInt32(String(_tag!))
            let x_address = Address.encodeXAddress(rAddress: rootAccount, tag: tag, test: false)
            XCTAssert(test[1] as! String == x_address)
            
            let xrpAddress = try! Address.decodeXAddress(xAddress: x_address)
            XCTAssert(xrpAddress.tag == tag && xrpAddress.rAddress == rootAccount)
        }
        XCTAssert(Address.encodeXAddress(rAddress: rootAccount, tag: 4294967295, test: false) == "XVLhHMPHU98es4dbozjVtdWzVrDjtV18pX8yuPT7y4xaEHi")
        XCTAssert(Address.encodeXAddress(rAddress: rootAccount, tag: 4294967294, test: false) == "XVLhHMPHU98es4dbozjVtdWzVrDjtV1kAsixQTdMjbWi39u")
        XCTAssert(Address.encodeXAddress(rAddress: "rPEPPER7kfTD9w2To4CQk6UCfuHM9c6GDY", tag: 12345, test: false) == "XV5sbjUmgPpvXv4ixFWZ5ptAYZ6PD28Sq49uo34VyjnmK5H")
        let address = try! Address.decodeXAddress(xAddress: "XV5sbjUmgPpvXv4ixFWZ5ptAYZ6PD28Sq49uo34VyjnmK5H")
        XCTAssert(address.rAddress == "rPEPPER7kfTD9w2To4CQk6UCfuHM9c6GDY" && address.tag == 12345)
        
    }
    
    func testGetBalance() {
        // create the expectation
        let exp = expectation(description: "Loading stories")
        
        // call my asynchronous method
        let wallet = try! SeedWallet(seed: "ssExhwra2PtqmPWYQvDyHTkycsdGn")
        _ = xrpLedger.getBalance(address: wallet.address).map { (result) in
            print(result)
            exp.fulfill()
        }
        
        // wait three seconds for all outstanding expectations to be fulfilled
        waitForExpectations(timeout: 3)
    }
    
    func testSerialization() {
        
        let tx1 = """
        {
        "Account": "rMBzp8CgpE441cp5PVyA9rpVV7oT8hP3ys",
        "Expiration": 595640108,
        "Fee": "10",
        "Flags": 524288,
        "OfferSequence": 1752791,
        "Sequence": 1752792,
        "SigningPubKey": "03EE83BB432547885C219634A1BC407A9DB0474145D69737D09CCDC63E1DEE7FE3",
        "TakerGets": "15000000000",
        "TakerPays": {
        "currency": "USD",
        "issuer": "rvYAfWj5gh67oV6fW32ZzP3Aw4Eubs59B",
        "value": "7072.8"
        },
        "TransactionType": "OfferCreate",
        "TxnSignature": "30440220143759437C04F7B61F012563AFE90D8DAFC46E86035E1D965A9CED282C97D4CE02204CFD241E86F17E011298FC1A39B63386C74306A5DE047E213B0F29EFA4571C2C",
        "hash": "73734B611DDA23D3F5F62E20A173B78AB8406AC5015094DA53F53D39B9EDB06C"
        }
        """
        let tx2 = """
        {
        "TransactionType": "EscrowFinish",
        "Flags": 2147483648,
        "Sequence": 1,
        "OfferSequence": 11,
        "Fee": "10101",
        "SigningPubKey": "0268D79CD579D077750740FA18A2370B7C2018B2714ECE70BA65C38D223E79BC9C",
        "TxnSignature": "3045022100F06FB54049D6D50142E5CF2E2AC21946AF305A13E2A2D4BA881B36484DD01A540220311557EC8BEF536D729605A4CB4D4DC51B1E37C06C93434DD5B7651E1E2E28BF",
        "Account": "r3Y6vCE8XqfZmYBRngy22uFYkmz3y9eCRA",
        "Owner": "r9NpyVfLfUG8hatuCCHKzosyDtKnBdsEN3",
        "Memos": [
        {
        "Memo": {
        "MemoData": "04C4D46544659A2D58525043686174"
        }
        }
        ]
        }
        """
        let tx3 = """
        {
        "Account": "rweYz56rfmQ98cAdRaeTxQS9wVMGnrdsFp",
        "Amount": "10000000",
        "Destination": "rweYz56rfmQ98cAdRaeTxQS9wVMGnrdsFp",
        "Fee": "12",
        "Flags": 0,
        "LastLedgerSequence": 9902014,
        "Memos": [
        {
        "Memo": {
        "MemoData": "7274312E312E31",
        "MemoType": "636C69656E74"
        }
        }
        ],
        "Paths": [
        [
        {
        "account": "rPDXxSZcuVL3ZWoyU82bcde3zwvmShkRyF",
        "type": 1,
        "type_hex": "0000000000000001"
        },
        {
        "currency": "XRP",
        "type": 16,
        "type_hex": "0000000000000010"
        }
        ],
        [
        {
        "account": "rf1BiGeXwwQoi8Z2ueFYTEXSwuJYfV2Jpn",
        "type": 1,
        "type_hex": "0000000000000001"
        },
        {
        "account": "rMwjYedjc7qqtKYVLiAccJSmCwih4LnE2q",
        "type": 1,
        "type_hex": "0000000000000001"
        },
        {
        "currency": "XRP",
        "type": 16,
        "type_hex": "0000000000000010"
        }
        ]
        ],
        "SendMax": {
        "currency": "USD",
        "issuer": "rweYz56rfmQ98cAdRaeTxQS9wVMGnrdsFp",
        "value": "0.6275558355"
        },
        "Sequence": 842,
        "SigningPubKey": "0379F17CFA0FFD7518181594BE69FE9A10471D6DE1F4055C6D2746AFD6CF89889E",
        "TransactionType": "Payment",
        "TxnSignature": "3045022100D55ED1953F860ADC1BC5CD993ABB927F48156ACA31C64737865F4F4FF6D015A80220630704D2BD09C8E99F26090C25F11B28F5D96A1350454402C2CED92B39FFDBAF",
        "hash": "B521424226FC100A2A802FE20476A5F8426FD3F720176DC5CCCE0D75738CC208"
        }
        """
        
        let txs = [
            tx1 : "120007220008000024001ABED82A2380BF2C2019001ABED764D55920AC9391400000000000000000000000000055534400000000000A20B3C85F482532A9578DBB3950B85CA06594D165400000037E11D60068400000000000000A732103EE83BB432547885C219634A1BC407A9DB0474145D69737D09CCDC63E1DEE7FE3744630440220143759437C04F7B61F012563AFE90D8DAFC46E86035E1D965A9CED282C97D4CE02204CFD241E86F17E011298FC1A39B63386C74306A5DE047E213B0F29EFA4571C2C8114DD76483FACDEE26E60D8A586BB58D09F27045C46",
            tx2 : "1200022280000000240000000120190000000B68400000000000277573210268D79CD579D077750740FA18A2370B7C2018B2714ECE70BA65C38D223E79BC9C74473045022100F06FB54049D6D50142E5CF2E2AC21946AF305A13E2A2D4BA881B36484DD01A540220311557EC8BEF536D729605A4CB4D4DC51B1E37C06C93434DD5B7651E1E2E28BF811452C7F01AD13B3CA9C1D133FA8F3482D2EF08FA7D82145A380FBD236B6A1CD14B939AD21101E5B6B6FFA2F9EA7D0F04C4D46544659A2D58525043686174E1F1",
            tx3 : "1200002200000000240000034A201B009717BE61400000000098968068400000000000000C69D4564B964A845AC0000000000000000000000000555344000000000069D33B18D53385F8A3185516C2EDA5DEDB8AC5C673210379F17CFA0FFD7518181594BE69FE9A10471D6DE1F4055C6D2746AFD6CF89889E74473045022100D55ED1953F860ADC1BC5CD993ABB927F48156ACA31C64737865F4F4FF6D015A80220630704D2BD09C8E99F26090C25F11B28F5D96A1350454402C2CED92B39FFDBAF811469D33B18D53385F8A3185516C2EDA5DEDB8AC5C6831469D33B18D53385F8A3185516C2EDA5DEDB8AC5C6F9EA7C06636C69656E747D077274312E312E31E1F1011201F3B1997562FD742B54D4EBDEA1D6AEA3D4906B8F100000000000000000000000000000000000000000FF014B4E9C06F24296074F7BC48F92A97916C6DC5EA901DD39C650A96EDA48334E70CC4A85B8B2E8502CD310000000000000000000000000000000000000000000"
        ]
        
        for (tx, result) in txs {let jsonResult = try! JSONSerialization.jsonObject(with: tx.data(using: .utf8)!, options: .mutableLeaves)
            if let jsonResult = jsonResult as? [String:AnyObject] {
                let blob = Serializer().serializeTx(tx: jsonResult, forSigning: false)
                let hex = blob.toHexString().uppercased()
                XCTAssertEqual(hex, result.uppercased())
            }
            
        }
        
    }
    
    func testFundWallet() {
        let ED_wallet = try! SeedWallet(seed: "sEdVLSxBzx6Xi9XTqYj6a88epDSETKR")
        print(ED_wallet.address)
        print(ED_wallet.seed)
        print(ED_wallet.privateKey)
        print(ED_wallet.publicKey)
        // create the expectation
        let exp = expectation(description: "Loading stories")
        
        // call my asynchronous method
        let wallet = try! SeedWallet(seed: "ssA9fFYomuCurjdHQgxdLJjz1nhNn")
        let amount = try! Amount(drops: 500000000)
        let address = try! Address(rAddress: ED_wallet.address)
        let payment = Payment(from: wallet, to: address, amount: amount)
        payment.ledger.url = .xrpl_rpc_Testnet
        payment.send().map { (result) in
            print(result)
            exp.fulfill()
        }
        
        // wait three seconds for all outstanding expectations to be fulfilled
        waitForExpectations(timeout: 3)
    }
    
    
    // make sure this compiles (dont run)
    func ReadMe() {
        
        
        // ================================================================================================
        // Create a new wallet
        // ================================================================================================
        // create a completely new, randomly generated wallet
        let wallet = SeedWallet() // defaults to secp256k1
        let wallet2 = SeedWallet(type: .secp256k1)
        let wallet3 = SeedWallet(type: .ed25519)
        
        // ignore
        _ = wallet2.address + wallet3.address
        
        
        
        // ================================================================================================
        // Derive wallet from a seed
        // ================================================================================================
        // generate a wallet from an existing seed
        let walletFromSeed = try! SeedWallet(seed: "snsTnz4Wj8vFnWirNbp7tnhZyCqx9")
        
        // ignore
        _ = walletFromSeed
        
        // ================================================================================================
        // Derive wallet from a mnemonic
        // ================================================================================================

        let mnemonic = "abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon about"
        let walletFromMnemonic = try! MnemonicWallet(mnemonic: mnemonic)
        
        // ignore
        _ = walletFromMnemonic
        
        
        // ================================================================================================
        // Wallet properties
        // ================================================================================================
        print(wallet.address) // rJk1prBA4hzuK21VDK2vK2ep2PKGuFGnUD
        print(wallet.seed) // snsTnz4Wj8vFnWirNbp7tnhZyCqx9
        print(wallet.publicKey) // 02514FA7EF3E9F49C5D4C487330CC8882C0B4381BEC7AC61F1C1A81D5A62F1D3CF
        print(wallet.privateKey) // 003FC03417669696AB4A406B494E6426092FD9A42C153E169A2B469316EA4E96B7
        
        
        
        // ================================================================================================
        // Validation
        // ================================================================================================
        // Address
        let btc = "1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2"
        let xrp = "rPdCDje24q4EckPNMQ2fmUAMDoGCCu3eGK"
        
        _ = SeedWallet.validate(address: btc) // returns false
        _ = SeedWallet.validate(address: xrp) // returns true
        
        // Seed
        let seed = "shrKftFK3ZkMPkq4xe5wGB8HaNSLf"
        
        _ = SeedWallet.validate(seed: xrp) // returns false
        _ = SeedWallet.validate(seed: seed) // returns true
        
        
        
        // ================================================================================================
        // Transactions -> Sending XRP (offline signing)
        // ================================================================================================
        let amount = try! Amount(drops: 100000000)
        let address = try! Address(rAddress: "rPdCDje24q4EckPNMQ2fmUAMDoGCCu3eGK")
        
        let payment = Payment(from: wallet, to: address, amount: amount)
        payment.ledger.url = .xrpl_rpc_Testnet
        payment.send().map { (result) in
            print(result)
        }
        
        
        
        // ================================================================================================
        // Transactions -> Sending XRP with custom fields
        // ================================================================================================
        let fields: [String:Any] = [
            "TransactionType" : "Payment",
            "Account" : wallet.address,
            "Destination" : "rPdCDje24q4EckPNMQ2fmUAMDoGCCu3eGK",
            "Amount" : "10000000",
            "Flags" : 2147483648,
            "LastLedgerSequence" : 951547,
            "Fee" : "40",
            "Sequence" : 11,
        ]
        
        // create the transaction (offline)
        let transaction = RawTransaction(fields: fields)
        
        transaction.ledger.url = .xrpl_rpc_Testnet
        
        // sign the transaction (offline)
        let signedTransaction = try! transaction.sign(wallet: wallet)
        
        // submit the transaction (online)
        _ = signedTransaction.submit().map { (result) in
            print(result)
        }
        
        
        
        // ================================================================================================
        // Transactions -> Sending XRP with autofilled fields
        // ================================================================================================
        // dictionary containing partial transaction fields
        let partialFields: [String:Any] = [
            "TransactionType" : "Payment",
            "Destination" : "rPdCDje24q4EckPNMQ2fmUAMDoGCCu3eGK",
            "Amount" : "100000000",
            "Flags" : 2147483648,
        ]
        
        // create the transaction from dictionary
        let partialTransaction = Transaction(wallet: wallet, fields: partialFields)
        
        // autofills missing transaction fields (online)
        // signs transaction (offline)
        // submits transaction (online)
        _ = partialTransaction.send().map { (txResult) in
            print(txResult)
        }
        
        
        
        // ================================================================================================
        // Ledger Info -> Check balance
        // ================================================================================================
        _ = xrpLedger.getBalance(address: "rPdCDje24q4EckPNMQ2fmUAMDoGCCu3eGK").map { (amount) in
            print(amount.prettyPrinted()) // 1,800.000000
        }
    }
    
}
